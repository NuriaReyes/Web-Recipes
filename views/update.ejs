<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Nueva Receta</title>

    <link href="/Bootstrap/css/bootstrap.css" rel="stylesheet">
    <!-- <link href="/Bootstrap/css/custom.css" rel="stylesheet"> -->

  </head>
  <body>

    <% include navbar %>

    <% if (typeof error !== 'undefined') { %>
      <div class="col-md-offset-3 col-md-6">
          <div class="alert alert-dismissible alert-warning">
              <button type="button" class="close" data-dismiss="alert">&times;</button>
              <strong><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <%= error %>
              </strong>
          </div>
      </div>
    <% } %>

    <% if (typeof success !== 'undefined') { %>
      <div class="col-md-offset-3 col-md-6">
          <div class="alert alert-dismissible alert-success">
              <button type="button" class="close" data-dismiss="alert">&times;</button>
              <strong><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <%= success %>
              </strong>
          </div>
      </div>
    <% } %>

    <%
      var type = "no supe";
      switch (recipe.type){
        case "salad":
          type = "Ensaladas";
          break;
        case "maindish":
          type = "Platos fuertes";
          break;
        case "soup":
          type = "Sopas";
          break;
        case "dessert":
          type = "Postres";
          break;
        case "snack":
          type = "Snacks";
          break;
        case "drink":
          type = "Bebidas";
          break;
      }
    %>

    <div class="container col-md-8 col-md-offset-2">
      <div class="panel panel-default">
        <div class="panel-body">
          <% var dir =  "/recipe/update/" + recipe._id %>
          <form class="form-horizontal" name="newRecipe" method="post" action="<%= dir%>">
            <fieldset>
              <div class="col-md-10 col-md-offset-1">
                <legend><center>Modificar Receta</center></legend>
              </div>

              <div class="form-group">
                <div class="col-md-8 col-md-offset-2">
                  <label class="control-label" for="name">Nombre de receta: </label>
                  <input type="text" class="form-control" placeholder="Escriba nombre..." name="name" id="name" value="<%= recipe.name%>">
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-8 col-md-offset-2">
                  <label class="control-label" for="link">Link de imagen de receta: </label>
                  <input type="text" class="form-control" placeholder="Pegue el link completo de la imagen..." name="link" id="link" value="<%= recipe.link%>">
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-8 col-md-offset-2">
                  <label class="control-label" for="type">Tipo de platillo: </label>
                  <select class="form-control" name="type">
                    <option value="<%= recipe.type%>" selected><%= type%></option>
                    <option value="salad">Ensaladas</option>
                    <option value="maindish">Platos fuertes</option>
                    <option value="soup">Sopas</option>
                    <option value="dessert">Postres</option>
                    <option value="snack">Snacks</option>
                    <option value="drink">Bebidas</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-8 col-md-offset-2">
                  <a><span onclick="drawIngredients()" class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></a>
                  <a><span onclick="eraseIngredients()" class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span></a>
                  <label class="control-label">Ingredientes: </label>
                </div>
              </div>

              <div class="col-md-8 col-md-offset-2">
                <div id="ingredientsList">
                  <!-- autogenerated code -->
                  <% for (let a = 0; a < recipe.ingredients.length; a++) { %>
                    <% var id = "ingredient_" + a%>
                    <div class="form-group" id="<%= id%>">
                        <input type="text" class="form-control" placeholder="Ingrediente..." name="ing" onkeypress="return drawIng(event)" value="<%= recipe.ingredients[a]%>">
                    </div>
                  <% } %>
                </div>
              </div>

              <div class="form-group">
                <div class="col-md-8 col-md-offset-2">
                  <a><span onclick="drawSteps()" class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span></a>
                  <a><span onclick="eraseSteps()" class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span></a>
                  <label class="control-label">Instrucciones: </label>
                </div>
              </div>

              <div class="col-md-8 col-md-offset-2">
                <div id="stepsList">
                  <!-- autogenerated code -->
                  <% for (let a = 0; a < recipe.steps.length; a++) { %>
                    <% var id = "step_" + a%>
                    <div class="form-group" id="<%= id%>">
                      Paso <%= a + 1%>
                      <input type="text" class="form-control" placeholder="Describa paso" name="step" onkeypress="return drawSt(event)" value="<%= recipe.steps[a]%>">
                    </div>
                  <% } %>
                </div>
              </div>

              <input type="text" id="qIngredients" name="qIngredients" value="<%= recipe.ingredients.length%>" hidden="true">
              <input type="text" id="qSteps" name="qSteps" value="<%= recipe.steps.length%>" hidden="true">

              <div class="form-group">
                <div class="col-md-offset-5 col-md-2">
                  <button type="submit" class="btn btn-primary">Modificar Receta</button>
                </div>
              </div>
            </fieldset>
          </form>

        </div>
      </div>
    </div>

    <script>
      var i = parseFloat(document.getElementById("qIngredients").value);
      var ingredientsContainer = document.getElementById('ingredientsList');
      var drawIngredients = function(){
        var nodeIng = document.createElement("DIV");
        nodeIng.innerHTML =
          `<div class="form-group" id="ingredient_${i}">
              <input type="text" class="form-control" placeholder="Ingrediente..." name="ing" onkeypress="return drawIng(event)">
          </div>`;
        ingredientsContainer.appendChild(nodeIng);
          i++;
          document.getElementById("qIngredients").value = i;
      }
      var drawIng = function(e){
        if(e.keyCode == 13){
          drawIngredients();
          return false;
        }
      }
      var eraseIngredients = function(){
        if(i > 1){
          i--;
          console.log(i);
          var ingredient = document.getElementById('ingredient_' + i);
          ingredient.parentNode.removeChild(ingredient);
          document.getElementById("qIngredients").value = i;
        }
      }
    </script>

    <script>
      var j = 1 + parseFloat(document.getElementById("qSteps").value);
      var stepsContainer = document.getElementById('stepsList');
      var drawSteps = function(){
        var nodeSteps = document.createElement("DIV");
        nodeSteps.innerHTML =
        `<div class="form-group" id="step_${j}">
            Paso ${j}
            <input type="text" class="form-control" placeholder="Describa paso" name="step" onkeypress="return drawSt(event)">
          </div>`;
        stepsContainer.appendChild(nodeSteps);
          j++;
          document.getElementById("qSteps").value = j;
      }
      var drawSt = function(e){
        if(e.keyCode == 13){
          drawSteps();
          return false;
        }
      }
      var eraseSteps = function(){
        if(j > 2){
          j--;
          console.log(j);
          var step = document.getElementById('step_' + j);
          step.parentNode.removeChild(step);
          document.getElementById("qSteps").value = j;
        }
      }
    </script>

    <script src="/Bootstrap/js/jquery.min.js"></script>
    <script src="/Bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>
